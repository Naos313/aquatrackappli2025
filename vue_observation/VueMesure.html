<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="../webix/codebase/webix.css" type="text/css" charset="utf-8">
    <script src="../webix/codebase/webix.js" type="text/javascript" charset="utf-8"></script>
</head>
<body>
    <script type="text/javascript" charset="utf-8">
		const AdresseApi = "http://192.168.61.87:3000"
        webix.ready(function(){
            webix.ui({
                cols:[
                    {   
                        view: "scrollview",
                        scroll: "y",
                        body: {
                            rows:[
								{ view:"label", label:"temperature :" },
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#temperature#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Acidité :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#acidite#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Conductivité :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#conductivite#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Dureté Totale :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#durtotal#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Dureté Carbonatée :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#durcarbon#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Nitrites :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#nitrites#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Nitrates :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#nitrate#", xAxis:{ template:"#date#" }, yAxis:{} },
                                { view:"label", label:"Fer :"},
                                { height: 300, view:"chart", type:"line", url: AdresseApi+"/ppc", value:"#fer#", xAxis:{ template:"#date#" }, yAxis:{} }
                            ]
                        }
                    },
                    {   
                        view:"form",
                        width: 400,
                        id: "dataForm",
                        elements:[
                            { view:"label", label:"Dernière valeur :" },
                            { view:"label", id:"dateLabel", label:"Date :"},
                            { view:"label", id:"tempLabel", label:"Température :"},
                            { view:"label", id:"pHLabel", label:"Acidité :"},
                            { view:"label", id:"conductLabel", label:"Conductivité :"},
                            { view:"label", id:"durtotLabel", label:"Dureté Totale :"},
                            { view:"label", id:"durcarLabel", label:"Dureté Carbonatée :"},
                            { view:"label", id:"nitriteLabel", label:"Nitrites :"},
                            { view:"label", id:"nitrateLabel", label:"Nitrates :"},
                            { view:"label", id:"ferLabel", label:"Fer :"},
                            {view:"button" ,autowidth:true , value: "modifier mesures"}
                        ]
                    }
                    
                ]
            });

webix.ajax().get("http://192.168.61.87:3000/ppc", function(text, data){
    let response = data.json();
    console.log("Réponse API :", response);

    if(response.length > 0){
        let lastMeasurement = response[response.length - 1];

        for (let key in lastMeasurement) {
            let labelId = key + "Label";
            console.log(`Mise à jour : ${labelId} -> ${lastMeasurement[key]}`);

            if ($$(labelId)) { 
                $$(labelId).setValue(key.charAt(0).toUpperCase() + key.slice(1) + " : " + lastMeasurement[key]);
            }
        }
    }
});


        });
    </script>
</body>
</html>
